# üö® URGENT DEBUG MISSION - MODEL SELECTION BUG

**STATUS:** Critical bug in Œº2_AIPanel model selection - MUST FIX IMMEDIATELY

## üîç PROBLEM ANALYSIS
**SYMPTOM:** Model dropdown shows "Vision" selected but API call always goes to "nexus-online/claude-sonnet-4"

**ROOT CAUSE:** Model selection state not properly updating or double mapping issue

## üéØ IMMEDIATE ACTIONS FOR NEXT INSTANCE

### 1. DEBUG CURRENT STATE (5 minutes)
```typescript
// Add to Œº2_AIPanel.tsx before API call (around line 300):
console.log('üîç Model Debug:', { 
  Œº2_selectedModel, 
  actualModelName, 
  dropdownValue: document.querySelector('.model-select')?.value 
});
```

### 2. IDENTIFY THE BUG (10 minutes)
**Check these locations:**

**A) State Update Issue:**
- Line 742: `onChange={(e) => setŒº2_SelectedModel(e.target.value)}`
- Verify state actually changes when dropdown selected

**B) Model Mapping Issue:**
- Lines 292-298: Model mapping in API call function
- Lines 118-124: Model mapping in Œº2_callLiteLLMAPI function

**C) Parameter Passing Issue:**
- Line 303: `actualModelName` parameter to API call
- Line 126: `selectedModel = model` in Œº2_callLiteLLMAPI

### 3. LIKELY FIXES (15 minutes)

**Option A - State Update Fix:**
```typescript
// Add debug to onChange:
onChange={(e) => {
  console.log('Dropdown changed to:', e.target.value);
  setŒº2_SelectedModel(e.target.value);
}}
```

**Option B - Remove Double Mapping:**
```typescript
// In Œº2_callLiteLLMAPI, remove modelMap entirely:
// DELETE lines 118-124
// Use passed model parameter directly
```

**Option C - Force Correct Model:**
```typescript
// Test with hardcoded model:
const actualModelName = 'kira-local/llava-vision'; // Force vision
```

## üß™ TEST VERIFICATION
1. Select "Vision" in dropdown
2. Check console: Should see `model: "kira-local/llava-vision"`
3. Verify API response comes from Vision model

## üìù EXPECTED RESULT
```
üöÄ Œº2 LiteLLM API Call: 
Object { 
  baseUrl: "http://ai:4001", 
  model: "kira-local/llava-vision",  // ‚Üê THIS SHOULD CHANGE!
  agents: 3, 
  promptLength: 26 
}
```

## ‚ö° CONTEXT INFO
- CLAUDE.md contains all build instructions
- CONTEXT.md contains complete project overview
- All other features working perfectly
- This is the LAST bug before v2.1 completion!

## üéØ SUCCESS CRITERIA
- Model dropdown selection changes API call model parameter
- All 6 models (reasoning/fast/premium/vision/local) work correctly
- Console shows correct model name for each selection

**PRIORITY: HIGH - This blocks complete Model Selection feature!**

---
*Generated by Claude Code Session ending at 2% context - Next instance should start HERE immediately!*